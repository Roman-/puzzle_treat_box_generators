<!doctype html>
<meta charset="utf-8">
<title>Emoji Word Match v3 â€“ generator</title>

<!-- === size first === -->
<label>W <input id=w type=number value=800 min=50></label>
<label>H <input id=h type=number value=600 min=50></label>

<!-- === code + dice === -->
<label>Code <input id=code type=text value=1234 pattern="\d{3,5}" maxlength=5></label>
<button type=button data-t="code">&#x1F3B2;</button>

<hr>

<!-- === creativity === -->
<label>Grid columns
  <input id=gcols type=range min=2 max=8 value=5>
</label><br>

<label>Grid rows
  <input id=grows type=range min=2 max=8 value=4>
</label><br>

<label>Bubble size
  <input id=bsize type=range min=3 max=10 value=8>
</label><br>

<label>Border thickness
  <input id=bthick type=range min=0.5 max=5 step=0.5 value=1>
</label><br>

<label>Size variation %
  <input id=sizevar type=range min=0 max=30 value=15>
</label><br>

<label>Rotation &deg;
  <input id=rot type=range min=0 max=15 value=10>
</label><br>

<label>Emoji scale %
  <input id=escale type=range min=20 max=80 value=38>
</label><br>

<label>Number scale %
  <input id=nscale type=range min=10 max=50 value=22>
</label><br>

<label>Content gap %
  <input id=gap type=range min=0 max=30 value=5>
</label><br>

<label>Search bar height %
  <input id=barh type=range min=8 max=35 value=18>
</label><br>

<label>Emoji category
  <select id=cat>
    <option value="all">all</option>
    <option value="animals">animals</option>
    <option value="food">food</option>
    <option value="vehicles">vehicles</option>
    <option value="nature">nature</option>
    <option value="sports">sports</option>
    <option value="objects">objects</option>
  </select>
</label><br>

<label>Language
  <select id=lang>
    <option value="en">EN</option>
    <option value="ru">RU</option>
  </select>
</label><br>

<label>Bubble shape
  <select id=bshape>
    <option value="rounded-rect">Rounded Rect</option>
    <option value="circle">Circle</option>
    <option value="hexagon">Hexagon</option>
    <option value="cloud">Cloud</option>
  </select>
</label><br>

<label>Color palette
  <select id=palette>
    <option value="bold">bold</option>
    <option value="pastel">pastel</option>
    <option value="neon">neon</option>
    <option value="earth">earth</option>
    <option value="mono">mono</option>
  </select>
</label><br>

<label>Number position
  <select id=numpos>
    <option value="side">side</option>
    <option value="below">below</option>
    <option value="above">above</option>
  </select>
</label><br>

<label>Bubble arrangement
  <select id=arrange>
    <option value="grid">grid</option>
    <option value="scatter">scatter</option>
    <option value="ring">ring</option>
  </select>
</label><br>

<br>
<button id=reset type=button>Restore defaults</button>
<button id=rerender type=button>Re-render</button>

<hr>

<canvas id=can title="Click to download"
        style="border:1px solid grey;cursor:pointer;background:#fff"></canvas>

<!-- === emoji lexicon (embedded from shared/emojis.js) === -->
<script>
/**
 * Curated, child-safe emoji lexicon with bilingual names (EN/RU).
 * 98 emojis across 6 categories: animals, vehicles, food, nature, sports, objects.
 *
 * Ported from mystery-box-generators/src/resources/emoji-lexicon.ts + emojis.ts
 */

const EMOJI_LEXICON = [
  { emoji: 'ðŸ¶', category: 'animals', names: { en: { singular: 'dog', count: 'dogs' }, ru: { singular: 'ÑÐ¾Ð±Ð°ÐºÐ°', count: 'ÑÐ¾Ð±Ð°Ðº' } } },
  { emoji: 'ðŸ±', category: 'animals', names: { en: { singular: 'cat', count: 'cats' }, ru: { singular: 'ÐºÐ¾ÑˆÐºÐ°', count: 'ÐºÐ¾ÑˆÐµÐº' } } },
  { emoji: 'ðŸ­', category: 'animals', names: { en: { singular: 'mouse', count: 'mice' }, ru: { singular: 'Ð¼Ñ‹ÑˆÑŒ', count: 'Ð¼Ñ‹ÑˆÐµÐ¹' } } },
  { emoji: 'ðŸ¹', category: 'animals', names: { en: { singular: 'hamster', count: 'hamsters' }, ru: { singular: 'Ñ…Ð¾Ð¼ÑÐº', count: 'Ñ…Ð¾Ð¼ÑÐºÐ¾Ð²' } } },
  { emoji: 'ðŸ°', category: 'animals', names: { en: { singular: 'rabbit', count: 'rabbits' }, ru: { singular: 'ÐºÑ€Ð¾Ð»Ð¸Ðº', count: 'ÐºÑ€Ð¾Ð»Ð¸ÐºÐ¾Ð²' } } },
  { emoji: 'ðŸ¦Š', category: 'animals', names: { en: { singular: 'fox', count: 'foxes' }, ru: { singular: 'Ð»Ð¸ÑÐ°', count: 'Ð»Ð¸Ñ' } } },
  { emoji: 'ðŸ»', category: 'animals', names: { en: { singular: 'bear', count: 'bears' }, ru: { singular: 'Ð¼ÐµÐ´Ð²ÐµÐ´ÑŒ', count: 'Ð¼ÐµÐ´Ð²ÐµÐ´ÐµÐ¹' } } },
  { emoji: 'ðŸ¼', category: 'animals', names: { en: { singular: 'panda', count: 'pandas' }, ru: { singular: 'Ð¿Ð°Ð½Ð´Ð°', count: 'Ð¿Ð°Ð½Ð´' } } },
  { emoji: 'ðŸ¯', category: 'animals', names: { en: { singular: 'tiger', count: 'tigers' }, ru: { singular: 'Ñ‚Ð¸Ð³Ñ€', count: 'Ñ‚Ð¸Ð³Ñ€Ð¾Ð²' } } },
  { emoji: 'ðŸ¦', category: 'animals', names: { en: { singular: 'lion', count: 'lions' }, ru: { singular: 'Ð»ÐµÐ²', count: 'Ð»ÑŒÐ²Ð¾Ð²' } } },
  { emoji: 'ðŸ®', category: 'animals', names: { en: { singular: 'cow', count: 'cows' }, ru: { singular: 'ÐºÐ¾Ñ€Ð¾Ð²Ð°', count: 'ÐºÐ¾Ñ€Ð¾Ð²' } } },
  { emoji: 'ðŸ¸', category: 'animals', names: { en: { singular: 'frog', count: 'frogs' }, ru: { singular: 'Ð»ÑÐ³ÑƒÑˆÐºÐ°', count: 'Ð»ÑÐ³ÑƒÑˆÐµÐº' } } },
  { emoji: 'ðŸµ', category: 'animals', names: { en: { singular: 'monkey', count: 'monkeys' }, ru: { singular: 'Ð¾Ð±ÐµÐ·ÑŒÑÐ½Ð°', count: 'Ð¾Ð±ÐµÐ·ÑŒÑÐ½' } } },
  { emoji: 'ðŸ”', category: 'animals', names: { en: { singular: 'chicken', count: 'chickens' }, ru: { singular: 'ÐºÑƒÑ€Ð¸Ñ†Ð°', count: 'ÐºÑƒÑ€Ð¸Ñ†' } } },
  { emoji: 'ðŸ§', category: 'animals', names: { en: { singular: 'penguin', count: 'penguins' }, ru: { singular: 'Ð¿Ð¸Ð½Ð³Ð²Ð¸Ð½', count: 'Ð¿Ð¸Ð½Ð³Ð²Ð¸Ð½Ð¾Ð²' } } },
  { emoji: 'ðŸ¦†', category: 'animals', names: { en: { singular: 'duck', count: 'ducks' }, ru: { singular: 'ÑƒÑ‚ÐºÐ°', count: 'ÑƒÑ‚Ð¾Ðº' } } },
  { emoji: 'ðŸ¦‰', category: 'animals', names: { en: { singular: 'owl', count: 'owls' }, ru: { singular: 'ÑÐ¾Ð²Ð°', count: 'ÑÐ¾Ð²' } } },
  { emoji: 'ðŸ¦„', category: 'animals', names: { en: { singular: 'unicorn', count: 'unicorns' }, ru: { singular: 'ÐµÐ´Ð¸Ð½Ð¾Ñ€Ð¾Ð³', count: 'ÐµÐ´Ð¸Ð½Ð¾Ñ€Ð¾Ð³Ð¾Ð²' } } },
  { emoji: 'ðŸ¢', category: 'animals', names: { en: { singular: 'turtle', count: 'turtles' }, ru: { singular: 'Ñ‡ÐµÑ€ÐµÐ¿Ð°Ñ…Ð°', count: 'Ñ‡ÐµÑ€ÐµÐ¿Ð°Ñ…' } } },
  { emoji: 'ðŸ™', category: 'animals', names: { en: { singular: 'octopus', count: 'octopuses' }, ru: { singular: 'Ð¾ÑÑŒÐ¼Ð¸Ð½Ð¾Ð³', count: 'Ð¾ÑÑŒÐ¼Ð¸Ð½Ð¾Ð³Ð¾Ð²' } } },
  { emoji: 'ðŸ¦‹', category: 'animals', names: { en: { singular: 'butterfly', count: 'butterflies' }, ru: { singular: 'Ð±Ð°Ð±Ð¾Ñ‡ÐºÐ°', count: 'Ð±Ð°Ð±Ð¾Ñ‡ÐµÐº' } } },
  { emoji: 'ðŸ', category: 'animals', names: { en: { singular: 'bee', count: 'bees' }, ru: { singular: 'Ð¿Ñ‡ÐµÐ»Ð°', count: 'Ð¿Ñ‡Ñ‘Ð»' } } },
  { emoji: 'ðŸŒ', category: 'animals', names: { en: { singular: 'snail', count: 'snails' }, ru: { singular: 'ÑƒÐ»Ð¸Ñ‚ÐºÐ°', count: 'ÑƒÐ»Ð¸Ñ‚Ð¾Ðº' } } },
  { emoji: 'ðŸ ', category: 'animals', names: { en: { singular: 'fish', count: 'fish' }, ru: { singular: 'Ñ€Ñ‹Ð±Ð°', count: 'Ñ€Ñ‹Ð±' } } },

  { emoji: 'ðŸš—', category: 'vehicles', names: { en: { singular: 'car', count: 'cars' }, ru: { singular: 'Ð¼Ð°ÑˆÐ¸Ð½Ð°', count: 'Ð¼Ð°ÑˆÐ¸Ð½' } } },
  { emoji: 'ðŸšŒ', category: 'vehicles', names: { en: { singular: 'bus', count: 'buses' }, ru: { singular: 'Ð°Ð²Ñ‚Ð¾Ð±ÑƒÑ', count: 'Ð°Ð²Ñ‚Ð¾Ð±ÑƒÑÐ¾Ð²' } } },
  { emoji: 'ðŸšœ', category: 'vehicles', names: { en: { singular: 'tractor', count: 'tractors' }, ru: { singular: 'Ñ‚Ñ€Ð°ÐºÑ‚Ð¾Ñ€', count: 'Ñ‚Ñ€Ð°ÐºÑ‚Ð¾Ñ€Ð¾Ð²' } } },
  { emoji: 'ðŸš²', category: 'vehicles', names: { en: { singular: 'bicycle', count: 'bicycles' }, ru: { singular: 'Ð²ÐµÐ»Ð¾ÑÐ¸Ð¿ÐµÐ´', count: 'Ð²ÐµÐ»Ð¾ÑÐ¸Ð¿ÐµÐ´Ð¾Ð²' } } },
  { emoji: 'ðŸš†', category: 'vehicles', names: { en: { singular: 'train', count: 'trains' }, ru: { singular: 'Ð¿Ð¾ÐµÐ·Ð´', count: 'Ð¿Ð¾ÐµÐ·Ð´Ð¾Ð²' } } },
  { emoji: 'ðŸš', category: 'vehicles', names: { en: { singular: 'helicopter', count: 'helicopters' }, ru: { singular: 'Ð²ÐµÑ€Ñ‚Ð¾Ð»Ñ‘Ñ‚', count: 'Ð²ÐµÑ€Ñ‚Ð¾Ð»Ñ‘Ñ‚Ð¾Ð²' } } },
  { emoji: 'â›µ', category: 'vehicles', names: { en: { singular: 'sailboat', count: 'sailboats' }, ru: { singular: 'Ð¿Ð°Ñ€ÑƒÑÐ½Ð¸Ðº', count: 'Ð¿Ð°Ñ€ÑƒÑÐ½Ð¸ÐºÐ¾Ð²' } } },
  { emoji: 'ðŸš€', category: 'vehicles', names: { en: { singular: 'rocket', count: 'rockets' }, ru: { singular: 'Ñ€Ð°ÐºÐµÑ‚Ð°', count: 'Ñ€Ð°ÐºÐµÑ‚' } } },
  { emoji: 'ðŸš•', category: 'vehicles', names: { en: { singular: 'taxi', count: 'taxis' }, ru: { singular: 'Ñ‚Ð°ÐºÑÐ¸', count: 'Ñ‚Ð°ÐºÑÐ¸' } } },
  { emoji: 'ðŸš™', category: 'vehicles', names: { en: { singular: 'SUV', count: 'SUVs' }, ru: { singular: 'Ð²Ð½ÐµÐ´Ð¾Ñ€Ð¾Ð¶Ð½Ð¸Ðº', count: 'Ð²Ð½ÐµÐ´Ð¾Ñ€Ð¾Ð¶Ð½Ð¸ÐºÐ¾Ð²' } } },

  { emoji: 'ðŸŽ', category: 'food', names: { en: { singular: 'apple', count: 'apples' }, ru: { singular: 'ÑÐ±Ð»Ð¾ÐºÐ¾', count: 'ÑÐ±Ð»Ð¾Ðº' } } },
  { emoji: 'ðŸ', category: 'food', names: { en: { singular: 'pear', count: 'pears' }, ru: { singular: 'Ð³Ñ€ÑƒÑˆÐ°', count: 'Ð³Ñ€ÑƒÑˆ' } } },
  { emoji: 'ðŸŠ', category: 'food', names: { en: { singular: 'orange', count: 'oranges' }, ru: { singular: 'Ð°Ð¿ÐµÐ»ÑŒÑÐ¸Ð½', count: 'Ð°Ð¿ÐµÐ»ÑŒÑÐ¸Ð½Ð¾Ð²' } } },
  { emoji: 'ðŸ‹', category: 'food', names: { en: { singular: 'lemon', count: 'lemons' }, ru: { singular: 'Ð»Ð¸Ð¼Ð¾Ð½', count: 'Ð»Ð¸Ð¼Ð¾Ð½Ð¾Ð²' } } },
  { emoji: 'ðŸŒ', category: 'food', names: { en: { singular: 'banana', count: 'bananas' }, ru: { singular: 'Ð±Ð°Ð½Ð°Ð½', count: 'Ð±Ð°Ð½Ð°Ð½Ð¾Ð²' } } },
  { emoji: 'ðŸ‰', category: 'food', names: { en: { singular: 'watermelon', count: 'watermelons' }, ru: { singular: 'Ð°Ñ€Ð±ÑƒÐ·', count: 'Ð°Ñ€Ð±ÑƒÐ·Ð¾Ð²' } } },
  { emoji: 'ðŸ‡', category: 'food', names: { en: { singular: 'grape', count: 'grapes' }, ru: { singular: 'Ð²Ð¸Ð½Ð¾Ð³Ñ€Ð°Ð´Ð¸Ð½Ð°', count: 'Ð²Ð¸Ð½Ð¾Ð³Ñ€Ð°Ð´Ð¸Ð½' } } },
  { emoji: 'ðŸ“', category: 'food', names: { en: { singular: 'strawberry', count: 'strawberries' }, ru: { singular: 'ÐºÐ»ÑƒÐ±Ð½Ð¸ÐºÐ°', count: 'ÐºÐ»ÑƒÐ±Ð½Ð¸Ðº' } } },
  { emoji: 'ðŸ’', category: 'food', names: { en: { singular: 'cherry', count: 'cherries' }, ru: { singular: 'Ð²Ð¸ÑˆÐ½Ñ', count: 'Ð²Ð¸ÑˆÐµÐ½' } } },
  { emoji: 'ðŸ', category: 'food', names: { en: { singular: 'pineapple', count: 'pineapples' }, ru: { singular: 'Ð°Ð½Ð°Ð½Ð°Ñ', count: 'Ð°Ð½Ð°Ð½Ð°ÑÐ¾Ð²' } } },
  { emoji: 'ðŸ¥', category: 'food', names: { en: { singular: 'kiwi', count: 'kiwis' }, ru: { singular: 'ÐºÐ¸Ð²Ð¸', count: 'ÐºÐ¸Ð²Ð¸' } } },
  { emoji: 'ðŸ¥•', category: 'food', names: { en: { singular: 'carrot', count: 'carrots' }, ru: { singular: 'Ð¼Ð¾Ñ€ÐºÐ¾Ð²ÐºÐ°', count: 'Ð¼Ð¾Ñ€ÐºÐ¾Ð²Ð¾Ðº' } } },
  { emoji: 'ðŸŒ½', category: 'food', names: { en: { singular: 'corn cob', count: 'corn cobs' }, ru: { singular: 'Ð¿Ð¾Ñ‡Ð°Ñ‚Ð¾Ðº ÐºÑƒÐºÑƒÑ€ÑƒÐ·Ñ‹', count: 'Ð¿Ð¾Ñ‡Ð°Ñ‚ÐºÐ¾Ð² ÐºÑƒÐºÑƒÑ€ÑƒÐ·Ñ‹' } } },
  { emoji: 'ðŸ…', category: 'food', names: { en: { singular: 'tomato', count: 'tomatoes' }, ru: { singular: 'Ð¿Ð¾Ð¼Ð¸Ð´Ð¾Ñ€', count: 'Ð¿Ð¾Ð¼Ð¸Ð´Ð¾Ñ€Ð¾Ð²' } } },
  { emoji: 'ðŸ¥”', category: 'food', names: { en: { singular: 'potato', count: 'potatoes' }, ru: { singular: 'ÐºÐ°Ñ€Ñ‚Ð¾Ñ„ÐµÐ»Ð¸Ð½Ð°', count: 'ÐºÐ°Ñ€Ñ‚Ð¾Ñ„ÐµÐ»Ð¸Ð½' } } },
  { emoji: 'ðŸ¥¦', category: 'food', names: { en: { singular: 'broccoli', count: 'broccoli' }, ru: { singular: 'Ð±Ñ€Ð¾ÐºÐºÐ¾Ð»Ð¸', count: 'Ð±Ñ€Ð¾ÐºÐºÐ¾Ð»Ð¸' } } },
  { emoji: 'ðŸ¥’', category: 'food', names: { en: { singular: 'cucumber', count: 'cucumbers' }, ru: { singular: 'Ð¾Ð³ÑƒÑ€ÐµÑ†', count: 'Ð¾Ð³ÑƒÑ€Ñ†Ð¾Ð²' } } },
  { emoji: 'ðŸ•', category: 'food', names: { en: { singular: 'pizza', count: 'pizzas' }, ru: { singular: 'Ð¿Ð¸Ñ†Ñ†Ð°', count: 'Ð¿Ð¸Ñ†Ñ†' } } },
  { emoji: 'ðŸ”', category: 'food', names: { en: { singular: 'burger', count: 'burgers' }, ru: { singular: 'Ð±ÑƒÑ€Ð³ÐµÑ€', count: 'Ð±ÑƒÑ€Ð³ÐµÑ€Ð¾Ð²' } } },
  { emoji: 'ðŸŸ', category: 'food', names: { en: { singular: 'fries', count: 'fries' }, ru: { singular: 'ÐºÐ°Ñ€Ñ‚Ð¾ÑˆÐºÐ° Ñ„Ñ€Ð¸', count: 'Ð¿Ð¾Ñ€Ñ†Ð¸Ð¹ ÐºÐ°Ñ€Ñ‚Ð¾ÑˆÐºÐ¸ Ñ„Ñ€Ð¸' } } },
  { emoji: 'ðŸŒ­', category: 'food', names: { en: { singular: 'hot dog', count: 'hot dogs' }, ru: { singular: 'Ñ…Ð¾Ñ‚-Ð´Ð¾Ð³', count: 'Ñ…Ð¾Ñ‚-Ð´Ð¾Ð³Ð¾Ð²' } } },
  { emoji: 'ðŸŒ®', category: 'food', names: { en: { singular: 'taco', count: 'tacos' }, ru: { singular: 'Ñ‚Ð°ÐºÐ¾', count: 'Ñ‚Ð°ÐºÐ¾' } } },
  { emoji: 'ðŸŒ¯', category: 'food', names: { en: { singular: 'burrito', count: 'burritos' }, ru: { singular: 'Ð±ÑƒÑ€Ñ€Ð¸Ñ‚Ð¾', count: 'Ð±ÑƒÑ€Ñ€Ð¸Ñ‚Ð¾' } } },
  { emoji: 'ðŸ¿', category: 'food', names: { en: { singular: 'popcorn', count: 'popcorn buckets' }, ru: { singular: 'Ð¿Ð¾Ð¿ÐºÐ¾Ñ€Ð½', count: 'Ð²Ñ‘Ð´ÐµÑ€ Ð¿Ð¾Ð¿ÐºÐ¾Ñ€Ð½Ð°' } } },
  { emoji: 'ðŸª', category: 'food', names: { en: { singular: 'cookie', count: 'cookies' }, ru: { singular: 'Ð¿ÐµÑ‡ÐµÐ½ÑŒÐºÐ°', count: 'Ð¿ÐµÑ‡ÐµÐ½ÐµÐº' } } },
  { emoji: 'ðŸ©', category: 'food', names: { en: { singular: 'donut', count: 'donuts' }, ru: { singular: 'Ð¿Ð¾Ð½Ñ‡Ð¸Ðº', count: 'Ð¿Ð¾Ð½Ñ‡Ð¸ÐºÐ¾Ð²' } } },
  { emoji: 'ðŸ§', category: 'food', names: { en: { singular: 'cupcake', count: 'cupcakes' }, ru: { singular: 'ÐºÐ°Ð¿ÐºÐµÐ¹Ðº', count: 'ÐºÐ°Ð¿ÐºÐµÐ¹ÐºÐ¾Ð²' } } },
  { emoji: 'ðŸ°', category: 'food', names: { en: { singular: 'cake', count: 'cakes' }, ru: { singular: 'Ñ‚Ð¾Ñ€Ñ‚', count: 'Ñ‚Ð¾Ñ€Ñ‚Ð¾Ð²' } } },
  { emoji: 'ðŸ«', category: 'food', names: { en: { singular: 'chocolate bar', count: 'chocolate bars' }, ru: { singular: 'ÑˆÐ¾ÐºÐ¾Ð»Ð°Ð´ÐºÐ°', count: 'ÑˆÐ¾ÐºÐ¾Ð»Ð°Ð´Ð¾Ðº' } } },
  { emoji: 'ðŸ­', category: 'food', names: { en: { singular: 'lollipop', count: 'lollipops' }, ru: { singular: 'Ð»ÐµÐ´ÐµÐ½ÐµÑ†', count: 'Ð»ÐµÐ´ÐµÐ½Ñ†Ð¾Ð²' } } },
  { emoji: 'ðŸ¨', category: 'food', names: { en: { singular: 'ice cream', count: 'ice creams' }, ru: { singular: 'Ð¼Ð¾Ñ€Ð¾Ð¶ÐµÐ½Ð¾Ðµ', count: 'Ð¿Ð¾Ñ€Ñ†Ð¸Ð¹ Ð¼Ð¾Ñ€Ð¾Ð¶ÐµÐ½Ð¾Ð³Ð¾' } } },

  { emoji: 'ðŸŒ¸', category: 'nature', names: { en: { singular: 'flower', count: 'flowers' }, ru: { singular: 'Ñ†Ð²ÐµÑ‚Ð¾Ðº', count: 'Ñ†Ð²ÐµÑ‚Ð¾Ð²' } } },
  { emoji: 'ðŸ€', category: 'nature', names: { en: { singular: 'clover', count: 'clovers' }, ru: { singular: 'ÐºÐ»ÐµÐ²ÐµÑ€', count: 'ÐºÐ»ÐµÐ²ÐµÑ€Ð¾Ð²' } } },
  { emoji: 'ðŸŒ´', category: 'nature', names: { en: { singular: 'palm tree', count: 'palm trees' }, ru: { singular: 'Ð¿Ð°Ð»ÑŒÐ¼Ð°', count: 'Ð¿Ð°Ð»ÑŒÐ¼' } } },
  { emoji: 'ðŸŒµ', category: 'nature', names: { en: { singular: 'cactus', count: 'cactuses' }, ru: { singular: 'ÐºÐ°ÐºÑ‚ÑƒÑ', count: 'ÐºÐ°ÐºÑ‚ÑƒÑÐ¾Ð²' } } },
  { emoji: 'ðŸŒˆ', category: 'nature', names: { en: { singular: 'rainbow', count: 'rainbows' }, ru: { singular: 'Ñ€Ð°Ð´ÑƒÐ³Ð°', count: 'Ñ€Ð°Ð´ÑƒÐ³' } } },
  { emoji: 'ðŸŒ™', category: 'nature', names: { en: { singular: 'moon', count: 'moons' }, ru: { singular: 'Ð»ÑƒÐ½Ð°', count: 'Ð»ÑƒÐ½' } } },
  { emoji: 'ðŸŒž', category: 'nature', names: { en: { singular: 'sun', count: 'suns' }, ru: { singular: 'ÑÐ¾Ð»Ð½Ñ†Ðµ', count: 'ÑÐ¾Ð»Ð½Ñ†' } } },
  { emoji: 'ðŸŒŠ', category: 'nature', names: { en: { singular: 'wave', count: 'waves' }, ru: { singular: 'Ð²Ð¾Ð»Ð½Ð°', count: 'Ð²Ð¾Ð»Ð½' } } },

  { emoji: 'ðŸ€', category: 'sports', names: { en: { singular: 'basketball', count: 'basketballs' }, ru: { singular: 'Ð±Ð°ÑÐºÐµÑ‚Ð±Ð¾Ð»ÑŒÐ½Ñ‹Ð¹ Ð¼ÑÑ‡', count: 'Ð±Ð°ÑÐºÐµÑ‚Ð±Ð¾Ð»ÑŒÐ½Ñ‹Ñ… Ð¼ÑÑ‡ÐµÐ¹' } } },
  { emoji: 'ðŸŽ¾', category: 'sports', names: { en: { singular: 'tennis ball', count: 'tennis balls' }, ru: { singular: 'Ñ‚ÐµÐ½Ð½Ð¸ÑÐ½Ñ‹Ð¹ Ð¼ÑÑ‡', count: 'Ñ‚ÐµÐ½Ð½Ð¸ÑÐ½Ñ‹Ñ… Ð¼ÑÑ‡ÐµÐ¹' } } },
  { emoji: 'ðŸ', category: 'sports', names: { en: { singular: 'volleyball', count: 'volleyballs' }, ru: { singular: 'Ð²Ð¾Ð»ÐµÐ¹Ð±Ð¾Ð»ÑŒÐ½Ñ‹Ð¹ Ð¼ÑÑ‡', count: 'Ð²Ð¾Ð»ÐµÐ¹Ð±Ð¾Ð»ÑŒÐ½Ñ‹Ñ… Ð¼ÑÑ‡ÐµÐ¹' } } },
  { emoji: 'ðŸ‚', category: 'sports', names: { en: { singular: 'snowboarder', count: 'snowboarders' }, ru: { singular: 'ÑÐ½Ð¾ÑƒÐ±Ð¾Ñ€Ð´Ð¸ÑÑ‚', count: 'ÑÐ½Ð¾ÑƒÐ±Ð¾Ñ€Ð´Ð¸ÑÑ‚Ð¾Ð²' } } },
  { emoji: 'ðŸ›¹', category: 'sports', names: { en: { singular: 'skateboard', count: 'skateboards' }, ru: { singular: 'ÑÐºÐµÐ¹Ñ‚Ð±Ð¾Ñ€Ð´', count: 'ÑÐºÐµÐ¹Ñ‚Ð±Ð¾Ñ€Ð´Ð¾Ð²' } } },
  { emoji: 'ðŸŽ¯', category: 'sports', names: { en: { singular: 'target', count: 'targets' }, ru: { singular: 'Ð¼Ð¸ÑˆÐµÐ½ÑŒ', count: 'Ð¼Ð¸ÑˆÐµÐ½ÐµÐ¹' } } },
  { emoji: 'ðŸ†', category: 'sports', names: { en: { singular: 'trophy', count: 'trophies' }, ru: { singular: 'ÐºÑƒÐ±Ð¾Ðº', count: 'ÐºÑƒÐ±ÐºÐ¾Ð²' } } },

  { emoji: 'ðŸŽ', category: 'objects', names: { en: { singular: 'gift', count: 'gifts' }, ru: { singular: 'Ð¿Ð¾Ð´Ð°Ñ€Ð¾Ðº', count: 'Ð¿Ð¾Ð´Ð°Ñ€ÐºÐ¾Ð²' } } },
  { emoji: 'ðŸŽˆ', category: 'objects', names: { en: { singular: 'balloon', count: 'balloons' }, ru: { singular: 'ÑˆÐ°Ñ€Ð¸Ðº', count: 'ÑˆÐ°Ñ€Ð¸ÐºÐ¾Ð²' } } },
  { emoji: 'ðŸ§¸', category: 'objects', names: { en: { singular: 'teddy bear', count: 'teddy bears' }, ru: { singular: 'Ð¿Ð»ÑŽÑˆÐµÐ²Ñ‹Ð¹ Ð¼Ð¸ÑˆÐºÐ°', count: 'Ð¿Ð»ÑŽÑˆÐµÐ²Ñ‹Ñ… Ð¼Ð¸ÑˆÐµÐº' } } },
  { emoji: 'ðŸ“˜', category: 'objects', names: { en: { singular: 'book', count: 'books' }, ru: { singular: 'ÐºÐ½Ð¸Ð³Ð°', count: 'ÐºÐ½Ð¸Ð³' } } },
  { emoji: 'ðŸ“', category: 'objects', names: { en: { singular: 'ruler', count: 'rulers' }, ru: { singular: 'Ð»Ð¸Ð½ÐµÐ¹ÐºÐ°', count: 'Ð»Ð¸Ð½ÐµÐµÐº' } } },
  { emoji: 'ðŸ“Ž', category: 'objects', names: { en: { singular: 'paperclip', count: 'paperclips' }, ru: { singular: 'ÑÐºÑ€ÐµÐ¿ÐºÐ°', count: 'ÑÐºÑ€ÐµÐ¿Ð¾Ðº' } } },
  { emoji: 'ðŸ”', category: 'objects', names: { en: { singular: 'magnifying glass', count: 'magnifying glasses' }, ru: { singular: 'Ð»ÑƒÐ¿Ð°', count: 'Ð»ÑƒÐ¿' } } },
  { emoji: 'ðŸ”’', category: 'objects', names: { en: { singular: 'lock', count: 'locks' }, ru: { singular: 'Ð·Ð°Ð¼Ð¾Ðº', count: 'Ð·Ð°Ð¼ÐºÐ¾Ð²' } } },
  { emoji: 'â°', category: 'objects', names: { en: { singular: 'alarm clock', count: 'alarm clocks' }, ru: { singular: 'Ð±ÑƒÐ´Ð¸Ð»ÑŒÐ½Ð¸Ðº', count: 'Ð±ÑƒÐ´Ð¸Ð»ÑŒÐ½Ð¸ÐºÐ¾Ð²' } } },
  { emoji: 'ðŸ§­', category: 'objects', names: { en: { singular: 'compass', count: 'compasses' }, ru: { singular: 'ÐºÐ¾Ð¼Ð¿Ð°Ñ', count: 'ÐºÐ¾Ð¼Ð¿Ð°ÑÐ¾Ð²' } } },
  { emoji: 'ðŸ”‘', category: 'objects', names: { en: { singular: 'key', count: 'keys' }, ru: { singular: 'ÐºÐ»ÑŽÑ‡', count: 'ÐºÐ»ÑŽÑ‡ÐµÐ¹' } } },
  { emoji: 'ðŸ“', category: 'objects', names: { en: { singular: 'memo', count: 'memos' }, ru: { singular: 'Ð·Ð°Ð¿Ð¸ÑÐºÐ°', count: 'Ð·Ð°Ð¿Ð¸ÑÐ¾Ðº' } } },
];

const EMOJI_CATEGORY_NAMES = ['animals', 'vehicles', 'food', 'nature', 'sports', 'objects'];

const EMOJI_CATEGORIES = {};
for (const cat of EMOJI_CATEGORY_NAMES) {
  EMOJI_CATEGORIES[cat] = EMOJI_LEXICON.filter(e => e.category === cat).map(e => e.emoji);
}

const ALL_EMOJIS = EMOJI_LEXICON.map(e => e.emoji);

const getEmojiEntry = (emoji) => EMOJI_LEXICON.find(e => e.emoji === emoji);

const getEmojiName = (emoji, lang = 'en', form = 'singular') => {
  const entry = getEmojiEntry(emoji);
  if (!entry) return emoji;
  const localized = entry.names[lang] || entry.names.en;
  return localized[form] || entry.names.en[form];
};

const getEmojiPool = (category) => {
  if (!category || category === 'all') return ALL_EMOJIS.slice();
  return (EMOJI_CATEGORIES[category] || []).slice();
};

const pickDistinctEmojis = (n, category) => {
  const pool = (!category || category === 'all')
    ? EMOJI_LEXICON.slice()
    : EMOJI_LEXICON.filter(e => e.category === category);
  const emojis = pool.map(e => e.emoji);
  for (let i = emojis.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [emojis[i], emojis[j]] = [emojis[j], emojis[i]];
  }
  return emojis.slice(0, Math.min(n, emojis.length));
};
</script>

<!-- === range display === -->
<script>
document.querySelectorAll('input[type=range]').forEach(r => {
  const span = document.createElement('span');
  span.style.cssText = 'margin-left:1px;font-size:12px;color:#666';
  span.textContent = r.value;
  r.after(span);
  r.addEventListener('input', () => span.textContent = r.value);
});
</script>

<!-- === main logic === -->
<script>
const $ = id => document.getElementById(id);
const ctx = $('can').getContext('2d');
const NAME = 'emoji_word_match_v3';

const DEF = {
  w: 800, h: 600, code: '1234',
  gcols: 5, grows: 4, bsize: 8, bthick: 1,
  sizevar: 15, rot: 10,
  escale: 38, nscale: 22, gap: 5, barh: 18,
  cat: 'all', lang: 'en',
  bshape: 'rounded-rect', palette: 'bold', numpos: 'side', arrange: 'grid'
};

const PALETTES = {
  bold:   ['#E53935', '#1E88E5', '#43A047', '#FB8C00', '#8E24AA', '#00ACC1', '#D81B60', '#5C6BC0'],
  pastel: ['#FFB3BA', '#BAFFC9', '#BAE1FF', '#FFFFBA', '#E8BAFF', '#FFD9BA', '#BAFFEA', '#D4BAFF'],
  neon:   ['#FF073A', '#39FF14', '#00F0FF', '#FF6EC7', '#DFFF00', '#FF3503', '#04D9FF', '#B026FF'],
  earth:  ['#8B4513', '#556B2F', '#CD853F', '#6B8E23', '#A0522D', '#2E8B57', '#D2691E', '#708238'],
  mono:   ['#222', '#444', '#666', '#888', '#333', '#555', '#777', '#999']
};

function randCode() {
  const len = ($('code').value || '1234').length;
  $('code').value = Array.from({length: len}, () => Math.floor(Math.random() * 10)).join('');
}

function genUniqueNumber(len, usedSet) {
  let num;
  do {
    num = Array.from({length: len}, () => Math.floor(Math.random() * 10)).join('');
  } while (usedSet.has(num));
  usedSet.add(num);
  return num;
}

function roundRect(ctx, x, y, w, h, r) {
  r = Math.min(r, w / 2, h / 2);
  ctx.beginPath();
  ctx.moveTo(x + r, y);
  ctx.lineTo(x + w - r, y);
  ctx.arcTo(x + w, y, x + w, y + r, r);
  ctx.lineTo(x + w, y + h - r);
  ctx.arcTo(x + w, y + h, x + w - r, y + h, r);
  ctx.lineTo(x + r, y + h);
  ctx.arcTo(x, y + h, x, y + h - r, r);
  ctx.lineTo(x, y + r);
  ctx.arcTo(x, y, x + r, y, r);
  ctx.closePath();
}

function bubblePath(ctx, bw, bh, shape) {
  if (shape === 'circle') {
    const r = Math.min(bw, bh) / 2;
    ctx.beginPath();
    ctx.arc(0, 0, r, 0, Math.PI * 2);
    ctx.closePath();
  } else if (shape === 'hexagon') {
    const r = Math.min(bw, bh) / 2;
    ctx.beginPath();
    for (let i = 0; i < 6; i++) {
      const angle = Math.PI / 3 * i - Math.PI / 2;
      const px = Math.cos(angle) * r;
      const py = Math.sin(angle) * r;
      if (i === 0) ctx.moveTo(px, py);
      else ctx.lineTo(px, py);
    }
    ctx.closePath();
  } else if (shape === 'cloud') {
    const hw = bw / 2;
    const hh = bh / 2;
    const blobR = Math.min(hw, hh) * 0.45;
    ctx.beginPath();
    ctx.arc(0, 0, blobR * 1.1, 0, Math.PI * 2);
    ctx.moveTo(0 + blobR, -hh * 0.35);
    ctx.arc(0, -hh * 0.35, blobR, 0, Math.PI * 2);
    ctx.moveTo(0 + blobR, hh * 0.35);
    ctx.arc(0, hh * 0.35, blobR, 0, Math.PI * 2);
    ctx.moveTo(-hw * 0.4 + blobR, 0);
    ctx.arc(-hw * 0.4, 0, blobR, 0, Math.PI * 2);
    ctx.moveTo(hw * 0.4 + blobR, 0);
    ctx.arc(hw * 0.4, 0, blobR, 0, Math.PI * 2);
    ctx.moveTo(-hw * 0.28 + blobR * 0.85, -hh * 0.28);
    ctx.arc(-hw * 0.28, -hh * 0.28, blobR * 0.85, 0, Math.PI * 2);
    ctx.moveTo(hw * 0.28 + blobR * 0.85, -hh * 0.28);
    ctx.arc(hw * 0.28, -hh * 0.28, blobR * 0.85, 0, Math.PI * 2);
    ctx.moveTo(-hw * 0.28 + blobR * 0.85, hh * 0.28);
    ctx.arc(-hw * 0.28, hh * 0.28, blobR * 0.85, 0, Math.PI * 2);
    ctx.moveTo(hw * 0.28 + blobR * 0.85, hh * 0.28);
    ctx.arc(hw * 0.28, hh * 0.28, blobR * 0.85, 0, Math.PI * 2);
    ctx.closePath();
  } else {
    const radius = Math.min(bw, bh) * 0.2;
    roundRect(ctx, -bw / 2, -bh / 2, bw, bh, radius);
  }
}

function draw() {
  const W = +$('w').value || 800;
  const H = +$('h').value || 600;
  $('can').width = W;
  $('can').height = H;

  ctx.fillStyle = '#fff';
  ctx.fillRect(0, 0, W, H);

  const code = $('code').value || '1234';
  const cols = +$('gcols').value || 5;
  const rows = +$('grows').value || 4;
  const numBubbles = cols * rows;
  const bsizeFactor = +$('bsize').value || 6;
  const borderThick = +$('bthick').value || 2;
  const sizeVar = +$('sizevar').value || 0;
  const rotMax = +$('rot').value || 0;
  const emojiScale = +$('escale').value / 100;
  const numScale = +$('nscale').value / 100;
  const contentGap = +$('gap').value / 100;
  const barHPct = +$('barh').value / 100;
  const category = $('cat').value;
  const lang = $('lang').value;
  const bubbleShape = $('bshape').value;
  const paletteName = $('palette').value;
  const numpos = $('numpos').value;
  const arrange = $('arrange').value;

  const bubbleColors = PALETTES[paletteName] || PALETTES.bold;

  // --- Pick emojis ---
  const emojis = pickDistinctEmojis(numBubbles, category);
  const answerIdx = Math.floor(Math.random() * emojis.length);
  const answerEmoji = emojis[answerIdx];

  // --- Generate numbers ---
  const usedNumbers = new Set();
  usedNumbers.add(code);
  const numbers = emojis.map((em, i) => {
    if (i === answerIdx) return code;
    return genUniqueNumber(code.length, usedNumbers);
  });

  // --- Layout ---
  const mainFrac = 1 - barHPct;
  const mainH = H * mainFrac;
  const bottomH = H * barHPct;
  const bottomY = mainH;

  const cellW = W / cols;
  const cellH = mainH / rows;

  // Base bubble size from bsizeFactor (maps 3..10 to 0.4..0.85 of cell)
  const baseFrac = 0.4 + (bsizeFactor - 3) * (0.45 / 7);
  const baseBubW = cellW * baseFrac;
  const baseBubH = cellH * baseFrac;

  // Border thickness relative
  const bdrW = borderThick * (Math.min(W, H) / 300);

  // --- Compute bubble positions based on arrangement ---
  let bubblePositions;

  if (arrange === 'scatter') {
    bubblePositions = [];
    const margin = Math.max(baseBubW, baseBubH) * 0.6;
    const minDist = Math.min(cellW, cellH) * 0.55;
    for (let i = 0; i < emojis.length; i++) {
      let placed = false;
      for (let attempt = 0; attempt < 200; attempt++) {
        const cx = margin + Math.random() * (W - margin * 2);
        const cy = margin + Math.random() * (mainH - margin * 2);
        let tooClose = false;
        for (const p of bubblePositions) {
          const dx = cx - p.cx;
          const dy = cy - p.cy;
          if (Math.sqrt(dx * dx + dy * dy) < minDist) {
            tooClose = true;
            break;
          }
        }
        if (!tooClose) {
          bubblePositions.push({ cx, cy });
          placed = true;
          break;
        }
      }
      if (!placed) {
        bubblePositions.push({
          cx: margin + Math.random() * (W - margin * 2),
          cy: margin + Math.random() * (mainH - margin * 2)
        });
      }
    }
  } else if (arrange === 'ring') {
    bubblePositions = [];
    const centerX = W / 2;
    const centerY = mainH / 2;
    const radiusX = (W / 2) * 0.7;
    const radiusY = (mainH / 2) * 0.7;
    const n = emojis.length;
    const startAngle = -Math.PI / 2;
    for (let i = 0; i < n; i++) {
      const angle = startAngle + (2 * Math.PI * i) / n;
      bubblePositions.push({
        cx: centerX + radiusX * Math.cos(angle),
        cy: centerY + radiusY * Math.sin(angle)
      });
    }
  } else {
    // Grid (default)
    const positions = [];
    for (let r = 0; r < rows; r++) {
      for (let c = 0; c < cols; c++) {
        positions.push([r, c]);
      }
    }
    for (let i = positions.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [positions[i], positions[j]] = [positions[j], positions[i]];
    }
    bubblePositions = [];
    for (let i = 0; i < emojis.length; i++) {
      const [row, col] = positions[i];
      const cx = col * cellW + cellW / 2;
      const cy = row * cellH + cellH / 2;
      const varFactor = 1 + (Math.random() * 2 - 1) * (sizeVar / 100);
      const bw = baseBubW * varFactor;
      const bh = baseBubH * varFactor;
      const jitterX = (Math.random() * 2 - 1) * (cellW - bw) * 0.25;
      const jitterY = (Math.random() * 2 - 1) * (cellH - bh) * 0.25;
      bubblePositions.push({ cx: cx + jitterX, cy: cy + jitterY });
    }
  }

  // --- Draw bubbles ---
  for (let i = 0; i < emojis.length; i++) {
    const { cx, cy } = bubblePositions[i];
    const color = bubbleColors[i % bubbleColors.length];

    // Size variation
    const varFactor = 1 + (Math.random() * 2 - 1) * (sizeVar / 100);
    const bw = baseBubW * varFactor;
    const bh = baseBubH * varFactor;

    // Rotation
    const angle = (Math.random() * 2 - 1) * rotMax * Math.PI / 180;

    ctx.save();
    ctx.translate(cx, cy);
    ctx.rotate(angle);

    // Fill (low opacity)
    bubblePath(ctx, bw, bh, bubbleShape);
    ctx.fillStyle = color + '15';
    ctx.fill();

    // Border
    bubblePath(ctx, bw, bh, bubbleShape);
    ctx.strokeStyle = color;
    ctx.lineWidth = bdrW;
    ctx.stroke();

    // --- Content drawing based on numpos ---
    if (numpos === 'below') {
      const emojiSize = Math.min(bw * emojiScale, bh * 0.45);
      const numSize = Math.min(bw * numScale, bh * 0.3);
      const emojiY = -bh * 0.12;
      const numY = bh * 0.28;

      ctx.font = `${emojiSize}px sans-serif`;
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillStyle = '#000';
      ctx.fillText(emojis[i], 0, emojiY);

      ctx.font = `bold ${numSize}px sans-serif`;
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillStyle = '#333';
      ctx.fillText(numbers[i], 0, numY);

    } else if (numpos === 'above') {
      const numSize = Math.min(bw * numScale, bh * 0.3);
      const emojiSize = Math.min(bw * emojiScale, bh * 0.45);
      const numY = -bh * 0.2;
      const emojiY = bh * 0.18;

      ctx.font = `bold ${numSize}px sans-serif`;
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillStyle = '#333';
      ctx.fillText(numbers[i], 0, numY);

      ctx.font = `${emojiSize}px sans-serif`;
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillStyle = '#000';
      ctx.fillText(emojis[i], 0, emojiY);

    } else {
      // side (default): emoji left, number right
      const innerPad = bw * 0.06;
      const contentW = bw - innerPad * 2;
      const contentH = bh * 0.65;
      const gapW = contentW * contentGap;

      const emojiSize = Math.min(bw * emojiScale, contentH);
      let numSize = Math.min(bw * numScale, contentH * 0.7);

      ctx.font = `bold ${numSize}px sans-serif`;
      let numTextW = ctx.measureText(numbers[i]).width;
      const availForNum = contentW - emojiSize - gapW;
      if (numTextW > availForNum && availForNum > 0) {
        numSize *= availForNum / numTextW;
        ctx.font = `bold ${numSize}px sans-serif`;
        numTextW = ctx.measureText(numbers[i]).width;
      }

      const emojiCX = -bw / 2 + innerPad + emojiSize * 0.55;
      ctx.font = `${emojiSize}px sans-serif`;
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillStyle = '#000';
      ctx.fillText(emojis[i], emojiCX, 0);

      const numCX = bw / 2 - innerPad - numTextW / 2;
      ctx.font = `bold ${numSize}px sans-serif`;
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillStyle = '#333';
      ctx.fillText(numbers[i], numCX, 0);
    }

    ctx.restore();
  }

  // --- Bottom search bar ---
  const barPad = W * 0.06;
  const barX = barPad;
  const barY = bottomY + bottomH * 0.12;
  const barW = W - barPad * 2;
  const barH = bottomH * 0.76;
  const barRadius = barH * 0.35;

  // Bar background
  roundRect(ctx, barX, barY, barW, barH, barRadius);
  ctx.fillStyle = '#f0f0f0';
  ctx.fill();
  roundRect(ctx, barX, barY, barW, barH, barRadius);
  ctx.strokeStyle = '#ccc';
  ctx.lineWidth = Math.max(1, bdrW * 0.5);
  ctx.stroke();

  const barCY = barY + barH / 2;
  const iconSize = barH * 0.55;
  const wordSize = barH * 0.45;
  const qSize = barH * 0.38;

  // Magnifying glass icon
  ctx.font = `${iconSize}px sans-serif`;
  ctx.textAlign = 'left';
  ctx.textBaseline = 'middle';
  ctx.fillStyle = '#999';
  const iconX = barX + barH * 0.3;
  ctx.fillText('\u{1F50D}', iconX, barCY);

  // Target word (answer emoji name)
  const wordText = getEmojiName(answerEmoji, lang, 'singular');
  ctx.font = `bold ${wordSize}px sans-serif`;
  ctx.textAlign = 'left';
  ctx.textBaseline = 'middle';
  ctx.fillStyle = '#222';
  const wordX = iconX + iconSize * 1.2;

  // Scale down if word is too long
  const maxWordW = barW * 0.5;
  const measuredW = ctx.measureText(wordText).width;
  if (measuredW > maxWordW) {
    const scaled = wordSize * (maxWordW / measuredW);
    ctx.font = `bold ${scaled}px sans-serif`;
  }
  ctx.fillText(wordText, wordX, barCY);

  // "= ????"
  const qmarks = '?'.repeat(code.length);
  const eqText = '= ' + qmarks;
  ctx.font = `bold ${qSize}px sans-serif`;
  ctx.textAlign = 'right';
  ctx.textBaseline = 'middle';
  ctx.fillStyle = '#999';
  ctx.fillText(eqText, barX + barW - barH * 0.3, barCY);
}

// --- Live preview ---
oninput = draw;
draw();

// --- Dice button ---
document.querySelectorAll('[data-t]').forEach(b => {
  b.onclick = () => { if (b.dataset.t === 'code') { randCode(); draw(); } };
});

// --- Restore defaults ---
$('reset').onclick = () => {
  for (const k in DEF) {
    const el = $(k);
    if (!el) continue;
    if (el.tagName === 'SELECT') el.value = DEF[k];
    else el.value = DEF[k];
    if (el.type === 'range' && el.nextElementSibling) {
      el.nextElementSibling.textContent = el.value;
    }
  }
  draw();
};

// --- Re-render ---
$('rerender').onclick = draw;

// --- Click to download ---
$('can').onclick = () => {
  const c = $('code').value || '1234';
  const a = document.createElement('a');
  a.download = NAME + '_' + c + '.png';
  a.href = $('can').toDataURL();
  a.click();
  randCode();
  draw();
};
</script>
