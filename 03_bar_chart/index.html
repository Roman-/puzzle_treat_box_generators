<!doctype html>
<meta charset="utf-8">
<title>Bar Chart â€“ generator</title>

<!-- === size first === -->
<label>W <input id=w type=number value=800 min=50></label>
<label>H <input id=h type=number value=600 min=50></label>

<!-- === code (3â€“5 digits) + ðŸŽ² === -->
<label>Code <input id=code type=text value=1234 maxlength=5></label>
<button type=button data-t="code">ðŸŽ²</button>

<hr>

<!-- === creativity === -->
<label>Bar width (Ã— scene&nbsp;W)
  <input id=barW type=range min=0.40 max=0.90 step=0.01 value=0.60>
</label><br>

<label>Bar outline (Ã— scene&nbsp;H)
  <input id=outline type=range min=0 max=0.05 step=0.001 value=0.005>
</label><br>

<label>Color palette
  <select id=palette>
    <option value=bright>Bright</option>
    <option value=pastel>Pastel</option>
    <option value=warm>Warm</option>
    <option value=cool>Cool</option>
    <option value=neon>Neon</option>
  </select>
</label><br>

<label>Grid line thickness (Ã— H)
  <input id=lineT type=range min=0.001 max=0.02 step=0.001 value=0.005>
</label><br>

<label>Grid line color <input id=lineColor type=color value="#888888">
</label><br>

<label><input id=dash type=checkbox checked> Dashed grid lines</label><br>

<label><input id=floating type=checkbox> Floating bars</label><br>
<label><input id=digits type=checkbox checked> Draw digits</label><br>

<label>Label size (Ã— H)
  <input id=font type=range min=0.02 max=0.08 step=0.01 value=0.04>
</label><br>

<label>Arrow position (0=left, 1=right)
  <input id=arrowPos type=range min=0 max=1 step=0.01 value=0.25>
</label><br>

<label>Arrow thickness (Ã— H)
  <input id=arrowThick type=range min=0.002 max=0.02 step=0.001 value=0.003>
</label><br>

<label>Arrowhead span (Ã— bar&nbsp;W)
  <input id=arrowHead type=range min=0.02 max=0.30 step=0.01 value=0.08>
</label><br>

<label>Answer mask <input id=mask type=text value="0000" maxlength=5 style="width:60px">
</label> <small>1=digit, 0=?</small><br>

<button id=reset type=button>ðŸ”„ Restore defaults</button>

<hr>

<canvas id=can title="Click to download" style="border:1px solid grey;cursor:pointer"></canvas>

<script>
// Display current value next to range inputs
document.querySelectorAll('input[type=range]').forEach(r => {
  const span = document.createElement('span');
  span.style.cssText = 'margin-left:1px;font-size:12px;color:#666';
  span.textContent = r.value;
  r.after(span);
  r.addEventListener('input', () => span.textContent = r.value);
});
</script>
<script>
  const $ = id => document.getElementById(id);
  const ctx = $('can').getContext('2d');
  const NAME = 'bar_chart';
  const PALETTES = {
    bright: ['#ff4040','#4090ff','#00aa40','#ffd800','#ff8c00','#9b59b6','#e91e90','#00bcd4'],
    pastel: ['#ffb3ba','#bae1ff','#baffc9','#ffffba','#e8baff','#ffd9ba','#baffee','#ffbadc'],
    warm:   ['#ff4040','#ff8c00','#ffd800','#ff6b6b','#e74c3c','#f39c12','#d35400','#c0392b'],
    cool:   ['#4090ff','#00aa40','#00bcd4','#9b59b6','#3498db','#1abc9c','#2ecc71','#8e44ad'],
    neon:   ['#ff0080','#00ff80','#8000ff','#ff8000','#0080ff','#80ff00','#ff0040','#40ff00']
  };
  function seededShuffle(arr, seed) {
    const a = [...arr]; let s = Math.abs(seed) || 1;
    for (let i = a.length - 1; i > 0; i--) {
      s = (s * 1103515245 + 12345) & 0x7fffffff;
      const j = s % (i + 1);
      [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
  }

  const DEF = {
    w:800, h:600, code:'1234',
    barW:0.60, outline:0.005, palette:'bright',
    lineT:0.005, lineColor:'#888888', dash:true,
    floating:false, digits:true,
    font:0.04,
    arrowPos:0.25, arrowThick:0.003, arrowHead:0.08, mask:'0000'
  };

  function draw(){
    const W = +$('w').value, H = +$('h').value;
    $('can').width = W; $('can').height = H;
    ctx.fillStyle = '#fff'; ctx.fillRect(0,0,W,H);

    const codeVal = $('code').value.replace(/\D/g,'') || '1234';
    const N = Math.max(3, Math.min(5, codeVal.length));
    const digitsArr = codeVal.padEnd(N,'0').slice(0,N).split('').map(Number);

    const axisFont = +$('font').value * H;
    const marginV = axisFont * 1.5;
    const axisW   = axisFont * 2;
    const chartW  = W - axisW - axisFont; // small right margin
    const chartH  = H - 2*marginV;
    const step    = chartH / 10;

    ctx.font = `${axisFont}px sans-serif`;
    ctx.textAlign = 'right';
    ctx.textBaseline = 'middle';

    const showDigits = $('digits').checked;
    const floating  = $('floating').checked;

    // grid lines and labels
    ctx.strokeStyle = $('lineColor').value;
    ctx.lineWidth = +$('lineT').value * H;
    if ($('dash').checked) ctx.setLineDash([6,4]);
    for (let i=0;i<=9;i++){
      const y = H - marginV - step*i;
      ctx.beginPath();
      ctx.moveTo(axisW, y);
      ctx.lineTo(axisW + chartW, y);
      ctx.stroke();
      ctx.fillStyle = '#000';
      if (showDigits) ctx.fillText(i, axisW - 4, y);
    }
    ctx.setLineDash([]);

    // bars
    const barArea = chartW / N;
    const barW = barArea * +$('barW').value;
    const outline = +$('outline').value * H;
    const palName = $('palette').value || 'bright';
    const codeSeed = parseInt($('code').value || '1234', 10);
    const colors = seededShuffle(PALETTES[palName] || PALETTES.bright, codeSeed).slice(0, N);

    const mask = ($('mask').value||'0'.repeat(N)).padEnd(N,'0').slice(0,N);
    const arrowPosVal = +$('arrowPos').value;
    const arrowLW = +$('arrowThick').value * H;

    for (let i=0;i<N;i++){
      const h = digitsArr[i] * step;
      const x = axisW + barArea*i + (barArea - barW)/2;
      const baseVal = floating ? Math.floor(Math.random()*(10 - digitsArr[i])) : 0;
      const y = H - marginV - step*(digitsArr[i] + baseVal);
      ctx.fillStyle = colors[i % colors.length];
      ctx.fillRect(x, y, barW, h);
      if (outline>0){
        ctx.lineWidth = outline;
        ctx.strokeStyle = '#000';
        ctx.strokeRect(x, y, barW, h);
      }

      // arrow + label (skip if digit is 0)
      if (digitsArr[i] > 0) {
        const arrowX = x + arrowPosVal * barW;
        const yTop = y;
        const yBot = y + h;
        const headSize = barW * +$('arrowHead').value;

        // shaft
        ctx.beginPath();
        ctx.strokeStyle = '#000';
        ctx.lineWidth = arrowLW;
        ctx.moveTo(arrowX, yTop);
        ctx.lineTo(arrowX, yBot);
        ctx.stroke();

        // top arrowhead (pointing up)
        ctx.beginPath();
        ctx.moveTo(arrowX - headSize, yTop + headSize);
        ctx.lineTo(arrowX, yTop);
        ctx.lineTo(arrowX + headSize, yTop + headSize);
        ctx.stroke();

        // bottom arrowhead (pointing down)
        ctx.beginPath();
        ctx.moveTo(arrowX - headSize, yBot - headSize);
        ctx.lineTo(arrowX, yBot);
        ctx.lineTo(arrowX + headSize, yBot - headSize);
        ctx.stroke();

        // label: "?" or digit
        const midY = yTop + h / 2;
        const gap = headSize + arrowLW * 2;
        const label = mask[i] === '1' ? String(digitsArr[i]) : '?';
        ctx.font = `bold ${axisFont}px sans-serif`;
        ctx.textAlign = 'left';
        ctx.textBaseline = 'middle';
        ctx.fillStyle = '#000';
        ctx.fillText(label, arrowX + gap, midY);

        // restore text settings for axis labels
        ctx.font = `${axisFont}px sans-serif`;
        ctx.textAlign = 'right';
      }
    }
  }
  oninput = draw; draw();

  function randCode(){
    const n = Math.max(3, Math.min(5, ($('code').value.replace(/\D/g,'') || '1234').length));
    const max = Math.pow(10, n);
    $('code').value = (Math.random()*max|0).toString().padStart(n,'0');
  }

  document.querySelectorAll('[data-t]').forEach(b => b.onclick = () => { if(b.dataset.t==='code'){ randCode(); draw(); } });

  $('reset').onclick = () => {
    for (const k in DEF){
      const el = $(k);
      if (!el) continue;
      if (el.type === 'checkbox') el.checked = DEF[k];
      else                        el.value   = DEF[k];
    }
    draw();
  };

  $('can').onclick = () => {
    const codeVal = $('code').value.replace(/\D/g,'') || '1234';
    const n = Math.max(3, Math.min(5, codeVal.length));
    const c = codeVal.padEnd(n,'0').slice(0,n);
    const a = document.createElement('a');
    a.download = `${NAME}_${c}.png`;
    a.href = $('can').toDataURL();
    a.click();
    randCode(); draw();
  };
</script>
