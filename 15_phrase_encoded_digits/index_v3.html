<!doctype html>
<meta charset="utf-8">
<title>Dice Roll Sequence â€“ generator</title>

<!-- === size first === -->
<label>W <input id=w type=number value=1200 min=50></label>
<label>H <input id=h type=number value=400 min=50></label>

<!-- === code + ðŸŽ² === -->
<label>Code <input id=code type=text value=1234 pattern="\d{3,5}" maxlength=5></label>
<button type=button data-t="code">ðŸŽ²</button>

<hr>

<!-- === creativity === -->
<label>Die size
  <input id=dieSize type=range min=0.4 max=0.95 step=0.05 value=0.75>
</label><br>

<label>Pip size
  <input id=pipSize type=range min=0.06 max=0.20 step=0.01 value=0.12>
</label><br>

<label>Corner radius
  <input id=cornerRadius type=range min=0 max=0.25 step=0.01 value=0.15>
</label><br>

<label>Die spacing
  <input id=dieSpacing type=range min=0 max=0.4 step=0.02 value=0.15>
</label><br>

<label><input id=show3D type=checkbox checked> 3D shadow effect</label><br>

<label><input id=colorMode type=checkbox> Alternating die colors</label><br>

<label>Pip color
  <input id=pipColor type=color value="#1a1a1a">
</label><br>

<label>Die color
  <input id=dieColor type=color value="#ffffff">
</label><br>

<label>Alt die color
  <input id=altDieColor type=color value="#e8f4e8">
</label><br>

<button id=reset type=button>ðŸ”„ Restore defaults</button>

<hr>

<canvas id=can title="Click to download"
        style="border:1px solid grey;cursor:pointer"></canvas>

<script>
// Display current value next to range inputs
document.querySelectorAll('input[type=range]').forEach(r => {
  const span = document.createElement('span');
  span.style.cssText = 'margin-left:4px;font-size:12px;color:#666';
  span.textContent = r.value;
  r.after(span);
  r.addEventListener('input', () => span.textContent = r.value);
});
</script>
<script>
const $ = id => document.getElementById(id);
const ctx = $('can').getContext('2d');
const NAME = 'dice_sequence';
const DEF = {
  w: 1200, h: 400, code: '1234',
  dieSize: 0.75, pipSize: 0.12, cornerRadius: 0.15, dieSpacing: 0.15,
  show3D: true, colorMode: false,
  pipColor: '#1a1a1a', dieColor: '#ffffff', altDieColor: '#e8f4e8'
};

// Pip positions for 0-9 in a 3x3 grid
// Grid:  0 1 2
//        3 4 5
//        6 7 8
const pipPatterns = {
  0: [],
  1: [4],
  2: [0, 8],
  3: [0, 4, 8],
  4: [0, 2, 6, 8],
  5: [0, 2, 4, 6, 8],
  6: [0, 2, 3, 5, 6, 8],
  7: [0, 2, 3, 4, 5, 6, 8],
  8: [0, 1, 2, 3, 5, 6, 7, 8],
  9: [0, 1, 2, 3, 4, 5, 6, 7, 8]
};

function draw() {
  const W = +$('w').value, H = +$('h').value;
  $('can').width = W; $('can').height = H;
  ctx.fillStyle = '#fff';
  ctx.fillRect(0, 0, W, H);

  const codeStr = $('code').value || '1234';
  const digits = codeStr.split('').map(Number).filter(d => !isNaN(d));
  const N = digits.length || 4;

  const dieSizeFrac = +$('dieSize').value;
  const pipSizeFrac = +$('pipSize').value;
  const cornerRadiusFrac = +$('cornerRadius').value;
  const dieSpacingFrac = +$('dieSpacing').value;
  const show3D = $('show3D').checked;
  const colorMode = $('colorMode').checked;
  const pipColor = $('pipColor').value;
  const dieColor = $('dieColor').value;
  const altDieColor = $('altDieColor').value;

  // Calculate die dimensions (dice are square)
  const maxDieSize = Math.min(H * dieSizeFrac, (W * 0.9) / N);
  const dieSize = maxDieSize;
  const spacing = dieSize * dieSpacingFrac;

  const totalWidth = N * dieSize + (N - 1) * spacing;
  const startX = (W - totalWidth) / 2;
  const startY = (H - dieSize) / 2;

  // Draw each die
  digits.forEach((digit, idx) => {
    const x = startX + idx * (dieSize + spacing);
    const y = startY;
    const bgColor = colorMode && idx % 2 === 1 ? altDieColor : dieColor;

    drawDie(x, y, dieSize, digit, {
      cornerRadiusFrac, pipSizeFrac, show3D, pipColor, dieColor: bgColor
    });
  });
}

function drawDie(x, y, size, digit, opts) {
  const radius = size * opts.cornerRadiusFrac;

  // 3D shadow
  if (opts.show3D) {
    const shadowOffset = size * 0.04;
    ctx.fillStyle = 'rgba(0,0,0,0.15)';
    roundRect(x + shadowOffset, y + shadowOffset, size, size, radius, true, false);
  }

  // Die body
  ctx.fillStyle = opts.dieColor;
  ctx.strokeStyle = '#333';
  ctx.lineWidth = Math.max(1, size * 0.02);
  roundRect(x, y, size, size, radius, true, true);

  // Draw pips
  drawPips(x, y, size, size, digit, opts.pipSizeFrac, opts.pipColor);
}

function drawPips(x, y, w, h, digit, pipSizeFrac, pipColor) {
  const pattern = pipPatterns[digit] || [];
  const pipR = Math.min(w, h) * pipSizeFrac;
  const padding = w * 0.18;
  const innerW = w - 2 * padding;
  const innerH = h - 2 * padding;

  ctx.fillStyle = pipColor;

  pattern.forEach(pos => {
    const col = pos % 3;
    const row = Math.floor(pos / 3);
    const px = x + padding + (col / 2) * innerW;
    const py = y + padding + (row / 2) * innerH;

    ctx.beginPath();
    ctx.arc(px, py, pipR, 0, Math.PI * 2);
    ctx.fill();
  });
}

function roundRect(x, y, w, h, r, fill, stroke) {
  ctx.beginPath();
  ctx.moveTo(x + r, y);
  ctx.lineTo(x + w - r, y);
  ctx.quadraticCurveTo(x + w, y, x + w, y + r);
  ctx.lineTo(x + w, y + h - r);
  ctx.quadraticCurveTo(x + w, y + h, x + w - r, y + h);
  ctx.lineTo(x + r, y + h);
  ctx.quadraticCurveTo(x, y + h, x, y + h - r);
  ctx.lineTo(x, y + r);
  ctx.quadraticCurveTo(x, y, x + r, y);
  ctx.closePath();
  if (fill) ctx.fill();
  if (stroke) ctx.stroke();
}

// Live preview
oninput = draw;
draw();

// Random code
function randCode() {
  const len = $('code').value.length || 4;
  $('code').value = Array.from({length: len}, () => Math.floor(Math.random() * 10)).join('');
}

document.querySelectorAll('[data-t]').forEach(b => b.onclick = () => {
  if (b.dataset.t === 'code') { randCode(); draw(); }
});

$('reset').onclick = () => {
  for (const k in DEF) {
    const el = $(k);
    if (!el) continue;
    if (el.type === 'checkbox') el.checked = DEF[k];
    else el.value = DEF[k];
  }
  document.querySelectorAll('input[type=range]').forEach(r => {
    const span = r.nextElementSibling;
    if (span && span.tagName === 'SPAN') span.textContent = r.value;
  });
  draw();
};

// Click to download
$('can').onclick = () => {
  const c = $('code').value || '1234';
  const a = document.createElement('a');
  a.download = `${NAME}_${c}.png`;
  a.href = $('can').toDataURL();
  a.click();
  randCode();
  draw();
};
</script>
